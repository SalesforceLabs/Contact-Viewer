/*Copyright (C) 2009 Char Software Inc., DBA Localytics http://www.localytics.com/docs/opensourceinfo/#license-documentation */
var localyticsSession=function(){var z="init open close tagEvent tagScreen tagEvent upload".split(" "),A,B=30,t=1E4,O=6E4,P=!1,C,D,Q=1E5,c={},R="__ll_iu __ll_es __ll_ch __ll_pa __ll_csu __ll_cst __ll_csi __ll_csq __ll_cso __ll_ub __ll_lct __ll_chs __ll_fl".split(" "),$=/loaded|complete/,E,f,S,F,T,U,p,n,u,j,m,q,i,g,o,v=[],k,aa=function(a){console.log(a)},G=function(){},e=G;"undefined"===typeof console&&(console={});void 0===console.log&&(console.log=function(){});c._switchLogger=function(a){e=a?aa:
G};try{localStorage.getItem&&(k=window.localStorage)}catch(fa){e("Local Storage not supported!")}var H=navigator.userAgent;c._getStore=function(a,b){if(k){var d=k.getItem(a),c;if(d!=null)try{c=b?JSON.parse(d):d}catch(w){e("Error parsing JSON from localStorage."+a)}return c}};var r=function(a){var b=(c._getStore("__ll_chs",false)||"").length,a=a+((""+a).length-b);try{k.setItem("__ll_chs",a);return i=a}catch(d){}};c._writeStore=function(a,b){if(k){var d,l,w,f,h;if(i===void 0){i=c._getStore("__ll_chs",
true);if(!i){i=V();r(i)}}d=(d=c._getStore(a,false))?d.length:0;try{if(b==null){r(i-d);k.removeItem(a)}else{f=JSON.stringify(b);l=f.length;if(w=l-d){h=i+w;if(w<0)if(r(h)!==void 0)k.setItem(a,f);else{e("Write aborted: delta was negative, but unable to update storage");return}else{h=h+((""+h).length-(""+i).length);if(h<Q&&r(h)!==void 0)k.setItem(a,f);else{e("Write aborted: writing would exceed storage limits");return}}}else k.setItem(a,f)}return b}catch(g){e("Write to localStorage failed by exception.")}}};
var I=function(a){if(!f){e("No event store found, searching localStorage");f=c._getStore("__ll_es",true);if(!f){e("No event storage in localStorage found, creating an empty array");f=[]}}e("Pushing event to event store");f.push(a);c._writeStore("__ll_es",f)};c._send=function(a){var b=document.createElement("script"),d=document.head||document.getElementsByTagName("head")[0]||document.documentElement,l=c.__url__+"api/v2/applications/"+encodeURIComponent(A)+"/uploads?callback=localyticsSession.__callback__&client_date="+
(new Date).getTime()+"&data="+encodeURIComponent(a);e("Uploading blob: \n"+a);e("Request length: "+l.length);if(l.length>64E3){e("Upload length exceeds maximum supported length.  Deleting data without uploading.");c._clearStoredUploads()}else{b.async="async";b.src=l;b.onload=function(){if(!b.readyState||$.test(b.readyState)){e("Unloading script tag from header");b.onload=null;d&&b.parentNode&&d.removeChild(b);b=void 0}};d.insertBefore(b,d.firstChild)}};var V=function(){var a,b,d=0,e;a=0;for(b=R.length;a<
b;a=a+1)(e=c._getStore(R[a],false))&&e.length&&(d=d+e.length);return d},s=function(){var a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},J=function(){return(new Date).getTime()/1E3|0},ba=function(){return(new Date).getTime()},ca=function(){return false},K=function(){return[]},da=function(){return""},W=function(){return 0};c._getOrCreateProperty=function(a,b,d,e){if(e){a=d();c._writeStore(b,a)}else if(a==null){a=c._getStore(b,
true);if(!a){a=d();c._writeStore(b,a)}}return a};var L=function(a){return T=c._getOrCreateProperty(T,"__ll_csu",s,a)},X=function(a){return U=c._getOrCreateProperty(U,"__ll_cst",J,a)};c._getSessionIndex=function(){return p=c._getOrCreateProperty(p,"__ll_csi",W,false)};var x=function(){return u=c._getOrCreateProperty(u,"__ll_cso",ca,false)};c._getOSVersion=function(a){var b=a.split(/[)]?\s[(]?/),d,c=b.length,e=b[1];if(a.match(/iPhone|iPad|iPod/))(b=a.match(/OS (\d+)\D(\d+)/))&&b.length===3&&(d="iOS "+
b[1]+"."+b[2]);else if(e&&e.match(/Macintosh/))for(a=2;a<c;a++){if(b[a]=="OS"){c=a-1;e=a+2;for(d=a-1;d>1;d--)if(b[d].substr(-1)===";"||b[d]==="Intel"||b[d]==="CPU"){c=d+1;break}for(d=a+1;d<a+4;d++)if(b[d].substr(-1)===";"){e=d;break}else if(b[d]==="like"){e=d-1;break}d=b.splice(c,e-(c-1)).join(" ");d=d.replace(";","").replace("_",".").replace(/_\d$/,"").replace("Mac ","");break}}else if(/^Android/.test(b[3]))d=(b[3]+" "+b[4]).replace(";","");else if(b=a.match(/Windows NT (\d)\.(\d)/)){if(b.length>
2){a=b[1];b=b[2];a==="6"&&b==="2"?d="Windows 8":a==="6"&&b==="1"?d="Windows 7":a==="6"&&b==="0"?d="Windows Vista":a==="5"&&b==="1"?d="Windows XP":a==="5"&&b==="0"?d="Windows 2000":a==="5"&&b==="2"&&(d="Windows Server 2003")}}else if(a.match(/SymbOS/))d="SymbOS";else if(a.match(/BlackBerry/)&&(b=a.match(/Version\/(\d+)\./)))d="BlackBerry "+b[1];return d};c._generateHeader=function(){e("Generating a new header");var a=(navigator.language||navigator.userLanguage||"").toUpperCase(),b;if(a&&a.match(/-/)){b=
a.split(/-/);a=b[0];b=b[1]}else b=H.match(RegExp("^.*?\\(.*?"+a+"-(\\w\\w).*?\\).*?$","i"))[1];var d=navigator.platform,l=navigator.vendor,f=navigator.platform;F=c._getOrCreateProperty(F,"__ll_pa",J,false);n=c._getOrCreateProperty(n,"__ll_csq",W,false);n=n+1;c._writeStore("__ll_csq",n);var g={dt:"h",pa:F,seq:n,u:s()},h=A;E=c._getOrCreateProperty(E,"__ll_iu",s,false);h={dt:"a",au:h,iu:E,lv:"html5_2.0",ua:H};if(f)h.dmo=f;if(d)h.dp=d;if(a)h.dll=a;if(a=c._getOSVersion(H))h.dov=a;if(C)h.av=C;if(D)h.nc=
D;if(b)h.dc=b.toUpperCase();if(l)h.dma=l;g.attrs=h;return g};var M=function(a){return S=c._getOrCreateProperty(S,"__ll_ch",c._generateHeader,a)},Y=function(){if(o){e("Stopping close polling");window.clearTimeout(o);o=null}else e("No polling to stop")},Z=function(){c._markNewClose();o=window.setTimeout(Z,t)};c._markNewClose=function(){e("Marking a new close.");m=(new Date).getTime();return c._writeStore("__ll_lct",m)};c._clearStoredUploads=function(){j=null;c._writeStore("__ll_ub",j)};c._init=function(a,
b){A=a;if(b){b.polling!=null&&(t=b.polling?+b.polling:0);if(b.uploadTimeout)O=b.uploadTimeout;b.version&&(C=""+b.version);b.carrier&&(D=""+b.carrier);b.sessionTimeoutSeconds!=null?B=b.sessionTimeoutSeconds?+b.sessionTimeoutSeconds:0:b.timeout!=null&&(B=b.timeout?+b.timeout/1E3:0);b.storage!=null&&(Q=b.storage?+b.storage:0);b.logger!=null&&(P=!!b.logger);c._switchLogger(P)}i=V();r(i);M(true);e("LocalyticsSession successfully initialized")};c._open=function(){var a;m=c._getStore("__ll_lct",true)||0;
if((new Date).getTime()-m<1E3*B)e("Open called within timeout, resuming last session.");else{if(x()){e("Finalizing close with last polled close");Y();m=c._getOrCreateProperty(m,"__ll_lct",ba,false);g=c._getOrCreateProperty(g,"__ll_fl",K,false);a=m/1E3|0;var b=X(),d=a-b;a={dt:"c",u:s(),ss:b,su:L(),ct:a,ctl:d,cta:d};if(g.length>0)a.fl=g;I(a);g=[];c._writeStore("__ll_fl",g);c._writeStore("__ll_cso",false)}c._getSessionIndex();p=p+1;c._writeStore("__ll_csi",p);b=X(true);a={dt:"s",ct:b,u:L(true),nth:c._getSessionIndex()};
if((q=q||c._getStore("__ll_lot",true)||0)&&q!=0){d=b-q;d>=1&&(a.sl=Math.round(d))}q=c._writeStore("__ll_lot",b);I(a);u=true;c._writeStore("__ll_cso",u);e("Appended open tag to event store")}if(t)if(o)e("Already polling.");else{e("Beginning to poll for closes");o=window.setTimeout(Z,t)}else e("Polling timeout was set to 0; no close polling will be done.")};c._tagEvent=function(a,b){if(x()){var c,f,g={dt:"e",ct:J(),u:s(),su:L(),n:""+a};if(b){f={};for(c in b)b.hasOwnProperty(c)&&(f[c]=""+b[c]);g.attrs=
f}I(g);e("Tagged event: '"+a+"' with attributes (JSON): '"+JSON.stringify(f)+"'")}else e("Cannot tag event: either no session was opened, or it was already closed")};c._tagScreen=function(a){if(x()){g=c._getOrCreateProperty(g,"__ll_fl",K,false);a=""+a;if(g[(g.length||0)-1]!==a){g.push(a);c._writeStore("__ll_fl",g)}}else e("Cannot tag screen: either no session was opened, or it was already closed")};c._close=function(){if(x()){Y();c._markNewClose()}else e("Cannot close session: either no session was opened, or it was already closed")};
c._upload=function(){if(v.length>0){if((new Date).getTime()-v[0]>O){console.log("Upload in progress, returning");return}v=[]}f=c._getOrCreateProperty(f,"__ll_es",K,false);j=c._getOrCreateProperty(j,"__ll_ub",da,false);if((!f||f.length===0)&&!j)e("Nothing to upload, returning.");else{var a=f.splice(0),b="",d,g;a.unshift(M(false));d=0;for(g=a.length;d<g;d=d+1)b=b+(JSON.stringify(a[d])+"\n");j=j+b;c._writeStore("__ll_ub",j);f=null;c._writeStore("__ll_es",f);c._send(j);M(true)}};c.__callback__=function(a){a=
+a.response_code;v=[];e("Callback called with response:");if(a){e("Response code: "+a);if(a===202||a===200){e("Upload succeeded, clearing uploaded items.");c._clearStoredUploads()}else if(a>=400&&a>500){e("Response was 4XX, clearing items");c._clearStoredUploads()}}};c.__url__="//analytics.localytics.com/";var y,N,ea=z.length;for(y=0;y<ea;y++)N=z[y],c[N]=function(a){return function(){try{c["_"+a].apply(c,arguments)}catch(b){var d=a,e=b;console.log("> Call to Localytics client library failed .");console.log("> localyticsSession."+
d+" failed .");console.log("> "+e);console.log(e);for(d in z)c[d]=G}}}(N);return c}();
/*Copyright (c) 2011, salesforce.com <http://salesforce.com> , inc.*/
void 0===window.$j&&($j=$.noConflict());var sforce=window.sforce;void 0===sforce&&(sforce={});String.prototype.startsWith=function(a){return this.substr(0,a.length)===a};String.prototype.endsWith=function(a){return this.substr(this.length-a.length,this.length)===a};Array.prototype.last=function(){return this[this.length-1]};function htmlEncode(a){return a?$j("<div/>").text(a).html():a}function htmlDecode(a){return a?$j("<div/>").html(a).text():a}
function formatStr(a,b){a&&(a=htmlEncode(a));return a&&b&&a.length>b?a.substr(0,b-3)+"...":a}function cleanupPhone(a){return a?(a=htmlEncode(a),(a.trim().startsWith("+")?"+":"")+a.replace(/[^0-9]/g,"")):a}
function formatAddress(a){return(a.MailingStreet?htmlEncode(a.MailingStreet).replace(/\n/g,", ")+"\n":"")+(a.MailingCity?htmlEncode(a.MailingCity).replace(/\n/g,", ")+", ":"")+(a.MailingState?htmlEncode(a.MailingState).replace(/\n/g,", ")+" ":"")+(a.MailingPostalCode?htmlEncode(a.MailingPostalCode).replace(/\n/g,", ")+" ":"")+(a.MailingCountry?htmlEncode(a.MailingCountry).replace(/\n/g,""):"")}function getBaseUrl(){return siteUrl.endsWith("/")?siteUrl.substring(0,siteUrl.length-1):siteUrl}
function getFieldDescribe(){return eval("("+StorageManager.getSessionValue(contact_describe_storage_key)+")")}function truncateLongText(){}function isPortrait(){return window.innerHeight>window.innerWidth}var contact_describe_storage_key="SFDC-CONTACT-DESCRIBE";
function fetchContactDescribe(a){ManageUserSession.getApiClient().describeContactViaApex(function(a){contactLabel=a.label||"Contact";contactPluralLabel=a.labelPlural||"Contacts";if(a.fields){var c={};$j.each(a.fields,function(){var a={label:this.label,type:this.type,length:this.length};c[this.name]=a;"reference"==a.type&&(a.relationshipName=this.relationshipName,a.referenceTo=this.referenceTo,a.relationshipLabel=this.relationshipLabel||"",c[this.relationshipName]=a)});StorageManager.setSessionValue(contact_describe_storage_key,
JSON.stringify(c))}a.recordTypeInfos&&1<a.recordTypeInfos.length&&(hasRecordTypes=!0);a.childRelationships&&(hasChatterEnabled=a.childRelationships.some(function(a){return"ContactFeed"==a.childSObject}))},errorCallback,function(b,c){"function"==typeof a&&a("success"==c)})}
function createScroller(a,b,c){var d,e,f,g,a="object"==typeof a?a:$j("#"+a);if(b){var h=a.find("#pullDown")[0];h||($j(a.children().children().get(0)).before('<div id="pullDown"><span class="app-images appleui pullDownIcon"></span><span class="pullDownLabel">Pull down to refresh</span> </div>'),h=a.find("#pullDown")[0]);d=h.offsetHeight;e=function(){if(h.className.match("loading")){h.className="";h.querySelector(".pullDownLabel").innerHTML="Pull down to refresh"}};f=function(){if(this.y>5&&!h.className.match("flip")){h.className=
"flip";h.querySelector(".pullDownLabel").innerHTML="Release to refresh";this.minScrollY=0}else if(this.y<5&&h.className.match("flip")){h.className="";h.querySelector(".pullDownLabel").innerHTML="Pull down to refresh";this.minScrollY=-d}};g=function(){if(h.className.match("flip")){h.className="loading";h.querySelector(".pullDownLabel").innerHTML="Loading...";b()}}}var j={useTransition:!0,topOffset:d||0};c&&c.onBeforeScrollStart&&(j.onBeforeScrollStart=c.onBeforeScrollStart);e&&(j.onRefresh=e);f&&(j.onScrollMove=
f);g&&(j.onScrollEnd=g);return new iScroll(a[0],j)}
function errorCallback(a,b){if("error"==b){var c=a.responseText;try{c=$j.parseJSON(c)}catch(d){}switch(a.status){case 403:if(/NO_API_ACCESS/gi.test(a.responseText)&&ManageUserSession.isActive()){alert(c.message);logout(!0);break}case 401:alert(c.message||"Session expired. Please relogin.");ManageUserSession.invalidate(!0,function(){window.location.reload()});break;default:alert("Server Unavailable. Check network connection or try again later.")}}else b="timeout",alert("Session timed out."),ManageUserSession.invalidate(!0,
function(){window.location.reload()})}var last_visited_loc_storage_key="LAST-VISIT-LOC";function updateLastVisitLoc(a){a?StorageManager.setLocalValue(last_visited_loc_storage_key,a):StorageManager.clearLocalValue(last_visited_loc_storage_key)}
function getEulaResponse(a){SettingsManager.showEula(function(){ManageUserSession.getApiClient().submitEulaResponse(ManageUserSession.getClientId(),this.id,function(b){b.success&&"true"==b.success?(ManageUserSession.updateEula(!0),SettingsManager.hideEula(),"function"==typeof a&&a()):(b.error&&alert(b.error),b.errorCode&&"INVALID_CLIENT"==b.errorCode&&logout(!1))},errorCallback)},function(){logout(!0)})}
function logout(a){ManageUserSession.kill(function(){a||StorageManager.setSessionValue(login_redirect_storage_key,!1);window.location=getBaseUrl()})}
function getContacts(a,b){listView.showBusyIndicator("Loading...");ManageUserSession.getApiClient().queryContactsViaApex(a,function(a){sobjectModel.setRecords(a.records)},errorCallback,function(c,d){listView.updateList(sobjectModel.records);listView.hideBusyIndicator();listView.refreshScroller(function(){getContacts(a)});"function"==typeof b&&b("success"==d)})}
function searchContacts(a,b){listView.showBusyIndicator("Searching...");ManageUserSession.getApiClient().searchContactsViaApex(a,function(a){sobjectModel.setRecords(a)},errorCallback,function(c,d){listView.updateList(sobjectModel.records);listView.hideBusyIndicator();listView.refreshScroller(function(){searchContacts(a)});"function"==typeof b&&b(d)})}
function prepareSession(a){"false"==StorageManager.getSessionValue(login_redirect_storage_key)?(StorageManager.clearSessionValue(login_redirect_storage_key),setTimeout(SettingsManager.show,10)):ManageUserSession.initialize(function(){ManageUserSession.isEulaAccepted()?sessionCallback():getEulaResponse(sessionCallback)},a)}
void 0===sforce.Client&&(sforce.Client=function(){this.sessionHeader=null;this.SESSION_HEADER="App-Session"},sforce.Client.prototype.ajax=function(a,b,c,d,e,f){var g=this;$j.ajax({type:a,url:b,processData:!0,data:c,dataType:"json",success:d,error:e,complete:f,beforeSend:function(a){g.sessionHeader&&a.setRequestHeader(g.SESSION_HEADER,g.sessionHeader)}})},sforce.Client.prototype.setSessionHeader=function(a){this.sessionHeader=a},sforce.Client.prototype.getAuthorizeUrl=function(a){return getBaseUrl()+
"/services/apexrest/oauth2/?doAuthorize&host="+a},sforce.Client.prototype.refreshAccessToken=function(a,b,c,d,e,f){var g=getBaseUrl()+"/services/apexrest/oauth2/refreshAccess";this.ajax("POST",g,"rt="+c+"&pass="+a+"&cid="+b,d,e,f)},sforce.Client.prototype.obtainAccessToken=function(a,b,c,d,e,f){var g=getBaseUrl()+"/services/apexrest/oauth2/authenticate";this.ajax("POST",g,"code="+b+(c?"&pass="+c:"")+(a?"&host="+a:""),d,e,f)},sforce.Client.prototype.prepareSession=function(a,b,c){var d=getBaseUrl()+
"/services/apexrest/oauth2/prepareSession";this.ajax("POST",d,null,a,b,c)},sforce.Client.prototype.prepareSessionFromOAuth=function(a,b,c,d,e,f){var g=getBaseUrl()+"/services/apexrest/oauth2/prepareSession";this.ajax("POST",g,"accessToken="+a+"&instanceUrl="+b+"&identityUrl="+c,d,e,f)},sforce.Client.prototype.revokeSession=function(a,b,c,d,e){var f=getBaseUrl()+"/services/apexrest/oauth2/revokeSession";this.ajax("POST",f,a&&b?"cid="+a+"&rt="+b:"",c,d,e)},sforce.Client.prototype.queryContactsViaApex=
function(a,b,c,d){var e=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",e,"action=fetchContacts&filter="+a,b,c,d)},sforce.Client.prototype.retrieveContactViaApex=function(a,b,c,d,e){var f=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",f,"action=retrieveContact&id="+a+"&fields="+b,c,d,e)},sforce.Client.prototype.searchContactsViaApex=function(a,b,c,d){var e=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",e,"action=searchContacts&text="+a,b,c,d)},sforce.Client.prototype.fetchChatterViaApex=
function(a,b,c,d){var e=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",e,"action=fetchChatter&ids="+a,b,c,d)},sforce.Client.prototype.fetchActivitiesViaApex=function(a,b,c,d){var e=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",e,"action=fetchActivities&ids="+a,b,c,d)},sforce.Client.prototype.getUsersInfoViaApex=function(a,b,c,d,e){var f=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",f,"action=getUsersInfo&id="+a+"&fetchPhotos="+b,c,d,e)},sforce.Client.prototype.describeContactViaApex=
function(a,b,c){var d=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",d,"action=describeContact",a,b,c)},sforce.Client.prototype.getContactDetailsViaApex=function(a,b,c,d,e){var f=this,g=getBaseUrl()+"/ContactDetails",h=(new Date).getTimezoneOffset();$j.ajax({type:"GET",url:g,data:"id="+a+"&rtid="+(b||"")+"&tzOffset="+h,success:c,error:d,complete:e,beforeSend:function(a){f.sessionHeader&&a.setRequestHeader(f.SESSION_HEADER,f.sessionHeader)}})},sforce.Client.prototype.getContactAppEula=function(a,
b,c){var d=getBaseUrl()+"/ContactsAppEula";$j.ajax({type:"GET",url:d,success:a,error:b,complete:c})},sforce.Client.prototype.submitEulaResponse=function(a,b,c,d,e){var f=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",f,"action=manageEula&clientId="+a+"&eulaResponse="+b,c,d,e)});
var SettingsManager=function(){function a(c){if(c&&e!=c){d&&h();d=createScroller(b.find(".settings_body "+c));e=c;$j(window).orientationChange(function(){a()})}else d&&d.refresh()}var b,c,d,e,f,g=false,h=function(){if(d){d.destroy();e=d=void 0}},j=function(){var a=ManageUserSession.getLoginHostType();if(!a){a=b.find("#hosts table td")[0].id;ManageUserSession.setLoginHostType(a)}if(a){b.find("#connection #hostType #name").text(b.find("#hosts #"+a+" span").text());b.find("#hosts table td").css("color",
"black");b.find("#hosts #"+a).css("color","#395483").append(b.find("#hosts #check"))}b.find("#main #connection #host_url input").val(ManageUserSession.getLoginHostUrl())},k=function(c,d){ManageUserSession.getApiClient().getContactAppEula(function(a){a=$j(a);a.find("head, script").remove();b.find("#eula .content").empty().append(a);if(c){a=b.find("#eula_buttons").show();b.find("#eula").css("margin-bottom",a.outerHeight()+"px")}else b.find("#eula").css("margin-bottom","0")},errorCallback,function(b,
c){a("#eula");typeof d=="function"&&d(c)})},l=function(c,d,e,f){var h=$j(this),j;g&&setTimeout(function(){b.find("#main #connection #host_url input").blur()},10);h.addClass("cellselected");b.find("#header #done").hide();j=function(){h.removeClass("cellselected");b.find("#main").css("visibility","hidden");typeof f=="function"&&f()};if(useAnimations)b.find("#main").changePage(b.find(c),false,j);else{b.find("#main").hide();b.find(c).show().css("visibility","");j()}b.find("#header #title").text(d);a(c);
if(e){var k=b.find(c);b.find("#header #left").show().touch(function(){b.find("#header #left").hide().off();if(useAnimations)k.changePage(b.find("#main"),true,function(){k.css("visibility","hidden")});else{k.hide();b.find("#main").show().css("visibility","")}b.find("#header #title").text("Settings");ManageUserSession.isActive()&&b.find("#header #done").show();a("#main")})}},m=function(){b.positionCenterOf(window)};return{show:function(){var d,e;if(!c){c=true;b=$j("#app_settings");b.find("#main #connection #hostType").enableTap().click(function(){l("#hosts",
"Login Host",true,void 0)});b.find("#hosts table td").enableTap().click(function(){var a=$j(this);a.addClass("cellselected");ManageUserSession.setLoginHostType(this.id);j();setTimeout(function(){a.removeClass("cellselected")},100)});b.find("#main #connection #host_url input").focus(function(){g=true;$j(this).css("text-align","left")}).blur(function(){g=false;$j(this).val(ManageUserSession.getLoginHostUrl());$j(this).css("text-align","right");setTimeout(function(){$j(document.body).scrollTop(0)},10)});
b.find("#main #connection #host_url form").submit(function(){var a=b.find("#main #connection #host_url input"),c=b.find("#main #connection #host_url input").val().trim();(c=c.length==0||c.endsWith(".salesforce.com"))||alert('Custom host url must end with ".salesforce.com".');if(c){ManageUserSession.setLoginHostUrl(a.val());j();a.blur()}return false});b.find("#main #help #help_about").enableTap().click(function(){l("#about","About",true,void 0)});b.find("#main #help #help_faq").enableTap().click(function(){l("#faq",
"FAQ",true,function(){})});b.find("#main #help #help_eula").enableTap().click(function(){l("#eula","Contact Viewer EULA",true,k)});b.find("#loginbtn").off().enableTap().click(function(){prepareSession()});b.find("#logoutbtn").off().enableTap().click(function(){confirm("Logout user "+ManageUserSession.getUsername()+"?")&&logout(false)})}j();b.find("#header #title").text("Settings");b.find(".page").css("visibility","hidden");b.find("#main").css("visibility","visible");b.width()<500&&b.find("#header #left>div").text("Back");
if(ManageUserSession.isActive()){b.find("#header #done").show();b.find("#loginbtn").hide();b.find("#logoutbtn").show()}else{b.find("#loginbtn").show();b.find("#logoutbtn").hide()}f=$j("#loggedin").addOverlay();b.find("#username").setText(ManageUserSession.getUsername()||"None");b.find("#header #done").off("click").enableTap().click(function(){SettingsManager.hide();$j(this).off("click");if(!ManageUserSession.isActive())window.location=getBaseUrl()});ManageUserSession.isActive()||b.find("#header #done").hide();
d=window.innerHeight;e=(window.innerHeight-b.height())/2;b.hide().css("zIndex",$j.topZIndex(f.elem)+10).css({left:(window.innerWidth-b.width())/2});useAnimations?b.css({top:0}).show().slideIn("Y",d,e):b.css({top:e}).show();a("#main");b.orientationChange(m)},hide:function(a){var c=window.innerHeight,d=function(){b.hide();f.hide();typeof a=="function"&&a()};useAnimations?b.slideOut("Y",c,d):d();h();b.unbindOrientationChange(m)},showEula:function(a,c){SettingsManager.show();l("#eula","End User License Agreement",
false,function(){k(true);var d=b.find("#eula_buttons").show();d.find("#accept").off().enableTap().click(a);d.find("#decline").off().enableTap().click(c)})},hideEula:function(){SettingsManager.hide(function(){if(useAnimations)b.find("#eula").changePage(b.find("#main"),true);else{b.find("#eula").hide();b.find("#main").show().css("visibility","")}b.find("#eula").css("visibility","hidden");b.find("#eula_buttons").hide();b.find("#header #title").text("Settings")})}}}(),FeedPhotoRenderer=function(){this.userIds=
[]};FeedPhotoRenderer.prototype.getImage=function(a){this.userIds.push(a);return'<img class="feedImage app-images" id="photo__'+escape(a)+'"/>'};FeedPhotoRenderer.prototype.renderImages=function(a){if(this.userIds.length!=0){a||(a=$j(document.body));hasChatterEnabled&&ManageUserSession.getApiClient().getUsersInfoViaApex(this.userIds,hasChatterEnabled,function(b){$j.each(b.records,function(){a.find("#photo__"+escape(this.Id)).removeClass("app-images").attr("src",this.SmallPhotoUrl)})},errorCallback)}};
function feedRenderer(a,b,c){var d=$j("#feedscroller #feed"),e=d.find("ul");e.empty();d.find("div").remove();if(!a||a.length==0)d.append($j('<div style="padding-top:20px"></div>').text(b));else{var f=new FeedPhotoRenderer,g=getFieldDescribe();$j.each(a,function(){var a=this.attributes.type;a=="ContactFeed"?generateChatterItem(this,e,f,g,c):a=="Task"&&generateTaskItem(this,e,f,c)});f.renderImages(e)}}
function generateChatterItem(a,b,c,d,e){var f=a.Body||"";a.Type=="TrackedChange"&&(a.FeedTrackedChanges&&a.FeedTrackedChanges.records)&&$j.each(a.FeedTrackedChanges.records,function(){if(this.FieldName=="created")f="created this "+contactLabel.toLowerCase()+".";else if(this.FieldName=="contactUpdatedByLead")f="updated this "+contactLabel.toLowerCase()+" by converting a lead.";else if(this.FieldName=="contactCreatedFromLead")f="converted a lead to this "+contactLabel.toLowerCase()+".";else if(this.NewValue!=
null||this.OldValue!=null){var a;if(a=d[this.FieldName.split(".")[1]]){a=a.label;f="updated "+a+" from "+(this.OldValue||"blank")+" to "+(this.NewValue||"blank")}}});if(f&&f.length>0){var g;if(e&&e.includeParent){g=$j('<span style="font-weight:bold"></span>').text(a.Parent.Name);g=$j('<a href="#"/>').attr("id","contact_"+htmlEncode(a.Parent.Id)).append(g);g[0].onclick=e.onClickParent}e=$j('<div class="feedBody"></div>').append(g).append(g?"&nbsp;-&nbsp;":"").append($j("<strong></strong>").text(a.CreatedBy.Name)).append("&nbsp;").append($j("<span></span>").text(f)).append('<br/><span class="datetime">'+
$j.format.date(a.CreatedDate,"MMM dd, yyyy (at) hh:mm a")+"</span>");$j("<li></li>").append(c.getImage(a.CreatedBy.Id)).append(e).appendTo(b)}}
function generateTaskItem(a,b,c,d){var e;if(d&&d.includeParent){e=$j('<span style="font-weight:bold"></span>').text(a.Who.Name);e=$j('<a href="#"/>').attr("id","contact_"+htmlEncode(a.Who.Id)).append(e);e[0].onclick=d.onClickParent}d=$j('<div class="feedBody"></div>').append(e).append(e?"&nbsp;-&nbsp;":"").append($j("<strong></strong>").text(a.Owner.Name)).append(" "+(a.IsClosed?"completed":"owns")+" the task<br/>").append($j("<span></span>").text(a.Subject||"")).append('<br/><span class="datetime">'+
(a.ActivityDate?"Due on "+$j.format.date(a.ActivityDate,"MMM dd, yyyy"):"No Due Date.")+"</span>");$j("<li></li>").append(c.getImage(a.Owner.Id)).append(d).appendTo(b)}
void 0===sforce.ListView&&(sforce.ListView=function(a){this.options={onListSelect:null,onSearch:null,onItemSelect:null,listTypes:{owner:"My Records",follow:"Records I Follow",recent:"Recently Viewed"}};for(i in this.options)this.options[i]=a[i];this.selectedContactId=a.selectedContactId;this.view=$j("#listpage");this._init()},sforce.ListView.prototype={_init:function(){var a=this,b=function(b){var d=a.view.find("#header #listselect");d.on("webkitTransitionEnd",function(){b&&b.hide();a.view.find("#header #searchbar").show();
d.off("webkitTransitionEnd").hide();d.css("zIndex","");d.prev().css("zIndex","");a.showingListSelector=false});d.css("-webkit-transform","translateY(-"+d.height()+"px)")};a._addSearchListeners();a.view.find("#header #titlebar").off().enableTap().click(function(){if(!a.showingListSelector){a.showingListSelector=true;var c=a.view.find("#header #listselect"),d=a.view.find("#listscroller").addOverlay(),e=$j.topZIndex(d.elem);c.prev().css("zIndex",e+2);c.css("zIndex",e+1);c.css(vendor+"TransitionProperty",
"").css("-webkit-transform","translateY(-"+c.height()+"px)");c.css(vendor+"TransitionProperty","-webkit-transform").css("visibility","hidden").show("fast",function(){a.view.find("#header #searchbar").hide();c.css("visibility","").css("-webkit-transform","translateY(0px)");c.find("button").windowTouch(function(c){c.preventDefault();c=c.target;a.view.find("#header #searchbar>form>input[type=search]").val("");a.view.find("#header #searchbar>form>button").hide();b(d);a.displayList(c.id);return true},
function(a){var c=a.target;if(c.nodeType==3)c=c.parentNode;var e=$j("#listpage");($j(c).is(e)||e.has(c).length>0)&&a.preventDefault();b(d);return true},true)})}});a.view.find("#listscroller #scroller #contactlist").off().enableTap().click(function(b){var d=b.target;if(!a.loadingItem){d=$j(d).closest("li",a.view);b.preventDefault();d.length&&(!d.hasClass("listseparater")&&typeof a.options.onItemSelect=="function")&&a.selectContact(d[0].id.substring(8))}})},_addSearchListeners:function(){var a=this,
b=function(){var a=$j(this);a.val().length>0?a.next().show():a.next().hide()};a.view.find("#header #searchbar>form").submit(function(){var b=$j(this).find("input[type=search]").blur().val(),b=b.trim();if(b.length>1&&!b.startsWith("*")){a.searchTextLength=b.length;a.listFetchStartTime=Date.now();a.mode="search";a.view.find("#header #titlebar #title").html("Search Results");if(typeof a.options.onSearch=="function")a.options.onSearch(b)}return false});a.view.find("#header #searchbar>form>input[type=search]").focusin(function(){var a=
$j(this);a.windowTouch(function(){return false},function(){a.blur();return true},false)}).on("keydown",b).on("keyup",b);a.view.find("#header #searchbar #closebutton").off().enableTap().click(function(b){b.preventDefault();$j(this).hide().prev().val("").blur();if(a.mode=="search"){a.displayList(a.selectedListId);a.mode="list"}})},_initiateContactListScroller:function(a){var b=this;if(typeof a=="function")b.contactListPullDownCB=a;if(b.listpagescroll===void 0){b.listpagescroll=createScroller("listscroller",
function(){typeof b.contactListPullDownCB=="function"&&b.contactListPullDownCB()});$j(window).orientationChange(b._initiateContactListScroller)}else b.listpagescroll&&b.listpagescroll.refresh()},displayList:function(a,b){var c;this.listFetchStartTime=Date.now();c=a?this.view.find("#header #listselect button#"+a):this.view.find("#header #listselect button#recent");this.view.find("#header #titlebar #title").text(c.text());this.selectedListId=c[0].id;if(typeof this.options.onListSelect=="function")this.options.onListSelect(this.selectedListId,
b)},updateList:function(a){var b=this,c=b.view.find("#listscroller #scroller #contactlist"),d=b.view.find("#listscroller #scroller #resultCount");c.empty();d.empty();!a||a.length==0?d.text("No "+contactPluralLabel+" Found"):d.text("Found "+a.length+" "+contactPluralLabel);a.sort(function(a,b){var c=a.LastName.toLowerCase(),d=b.LastName.toLowerCase();return c==d?0:c>d?1:-1});var e=[];$j.each(a,function(){var a=htmlEncode(this.Id);if(e.length==0||this.LastName!=null&&e.last()!=this.LastName[0].toUpperCase()){e.push(this.LastName[0].toUpperCase());
$j("<li></li>").addClass("listseparater").text(e.last()).appendTo(c)}var d=$j("<li></li>").attr("id","contact_"+a);a==b.selectedContactId&&d.addClass("cellselected");d.text((this.FirstName||"")+" ").append($j("<strong></strong>").text(this.LastName||"")).appendTo(c)});b.mode=="search"?LocalyticsManager.tagSearch(b.searchTextLength,a.length,Date.now()-b.listFetchStartTime):LocalyticsManager.tagListView(this.selectedListId,a.length,Date.now()-b.listFetchStartTime)},resetSelectedContact:function(){this.selectedContactId=
null;this.view.find("#contactlist .cellselected").removeClass("cellselected")},selectContact:function(a){var b=this;b.resetSelectedContact();b.selectedContactId=a;b.view.find("#contactlist li#contact_"+a).addClass("cellselected");b.loadingItem=true;b.options.onItemSelect(b.selectedContactId,function(){b.loadingItem=false})},showBusyIndicator:function(a){this.busyInd=this.view.find("#listscroller").showActivityInd(a)},hideBusyIndicator:function(){this.busyInd&&this.busyInd.hide()},refreshScroller:function(a){this._initiateContactListScroller(a)}});
var ManageUserSession=function(){var a,b,c,d;return{isActive:function(){return b==true},isEulaAccepted:function(){return true},updateEula:function(){},getUsername:function(){return b?c:null},getApiClient:function(){return b?a:null},getLoginHostType:function(){return d.toLowerCase().indexOf("login.")==0?"host_production":d.toLowerCase().indexOf("test.")==0?"host_sandbox":"host_custom"},getLoginHostUrl:function(){return d},setLoginHostType:function(a){a.toLowerCase()=="host_production"?ManageUserSession.setLoginHostUrl("login.salesforce.com"):
a.toLowerCase()=="host_sandbox"?ManageUserSession.setLoginHostUrl("test.salesforce.com"):a.toLowerCase()=="host_custom"&&(d="")},setLoginHostUrl:function(a){a=a.toLowerCase();if(!b||d!=a&&confirm("Changing login host will logout the current logged in user. Are you sure you want to continue?")){d=a;SalesforceOAuthPlugin.setLoginDomain(null,null,d);b&&ManageUserSession.kill()}},initialize:function(e){if(b)e();else{var f,g,h,j;f=$j(document).showActivityInd("Authenticating...",false);g=new OAuthProperties(remoteAccessConsumerKey,
oauthRedirectURI,["api"],true,true);h=function(d){var e=function(e){if(e.success){b=true;c=e.username;a.setSessionHeader(e.sessionToken);f.hide();typeof d=="function"&&d()}else j()};return function(b){a.prepareSessionFromOAuth(b.accessToken,b.instanceUrl,b.identityUrl,e,j)}};j=function(a){SFHybridApp.logError("loginFailure: "+a);f.hide();confirm("Authentication failed. Do you want to retry?")&&ManageUserSession.initialize(e)};SalesforceOAuthPlugin.authenticate(h(e),j,g);$j(document).off("salesforceSessionRefresh").on("salesforceSessionRefresh",
function(a){h()(a.originalEvent.data)});SalesforceOAuthPlugin.getLoginDomain(function(a){d=a.toLowerCase()});a||(a=new sforce.Client)}},invalidate:function(d,f){d&&b&&a.revokeSession(null,null,null,null,f);a=b=c=void 0},kill:function(){if(b){ManageUserSession.invalidate();SalesforceOAuthPlugin.logout()}}}}();
void 0===sforce.SplitView&&(sforce.SplitView=function(){this.callbacks=$j.Callbacks();this._init()},sforce.SplitView.prototype={_init:function(){var a=this;isPortrait=function(){return window.innerHeight>window.innerWidth};var b=function(){switch(isPortrait()){case true:$j("#listpage").appendTo("#popover");$j("#popover").css("visibility","hidden").css("opacity","0").show();$j("#contactlist_button").show().text(contactPluralLabel).touch(function(){$j("#popover,#contactlist_button").windowTouch(function(){return false},
function(){a.focusOutContactList();return true},false);$j("#popover").css("visibility","").css("opacity","1")});break;case false:$j("#popover").hide();$j("#rightsection").before($j("#listpage"));$j("#contactlist_button").hide().unbindTouch();$j("#popover,#contactlist_button").unbindWindowTouch()}a.callbacks.fire(isPortrait())};$j(window).orientationChange(function(){(isPortrait()&&$j("#listpage").parent()[0].id!="popover"||!isPortrait()&&$j("#listpage").parent()[0].id=="popover")&&b()});b()},focusOutContactList:function(){switch(window.innerHeight>
window.innerWidth){case true:var a=$j("#popover"),b=function(){a.css("visibility","hidden").unbind("webkitTransitionEnd")};a.css("opacity")!="0"&&a.bind("webkitTransitionEnd",b);a.css("opacity","0");$j("#popover,#contactlist_button").unbindWindowTouch()}},addOrientationChangeCallback:function(a){typeof a=="function"&&this.callbacks.add(a)},removeOrientationChangeCallback:function(a){typeof a=="function"&&this.callbacks.remove(a)}});
var StorageManager=function(){return{checkLocalStorage:function(){return typeof localStorage=="undefined"?false:true},checkSessionStorage:function(){return typeof sessionStorage=="undefined"?false:true},clearAll:function(){this.checkLocalStorage()&&localStorage.clear();this.checkSessionStorage()&&sessionStorage.clear()},setLocalValue:function(a,b){this.checkLocalStorage()&&localStorage.setItem(a,b)},getLocalValue:function(a){if(this.checkLocalStorage())return localStorage.getItem(a)},clearLocalValue:function(a){this.checkLocalStorage()&&
localStorage.removeItem(a)},setSessionValue:function(a,b){this.checkSessionStorage()&&sessionStorage.setItem(a,b)},getSessionValue:function(a){if(this.checkSessionStorage())return sessionStorage.getItem(a)},clearSessionValue:function(a){this.checkSessionStorage()&&sessionStorage.removeItem(a)}}}();
void 0===window.LocalyticsManager&&(window.LocalyticsManager=function(){this.device=DEVICE_TYPE;localyticsSession.init(localyticsAppId);localyticsSession.open();localyticsSession.upload();this.uploadTimer=setInterval(localyticsSession.upload,6E4)});
void 0!=window.LocalyticsManager&&(LocalyticsManager.prototype.tagScreen=function(){},LocalyticsManager.prototype.tagSplitView=function(){},LocalyticsManager.prototype.tagPortraitView=function(){},LocalyticsManager.prototype.tagEvent=function(a,b){localyticsSession.tagEvent(a,b)},LocalyticsManager.prototype.tagListView=function(a,b){this.prevListName!=void 0&&this.prevListName&&this.tagEvent("LIST-"+this.prevListName.toUpperCase()+"-CLOSE",{timeSpent:(Date.now()-this.listTagTime)/1E3});this.tagEvent("LIST-"+
a.toUpperCase()+"-OPEN",{records:b});this.prevListName=a;this.listTagTime=Date.now()},LocalyticsManager.prototype.tagSearch=function(a){this.tagListView("search",a)},LocalyticsManager.prototype.tagDetailView=function(a,b){this.prevDetailView!=void 0&&this.prevDetailView&&this.tagEvent(this.device+"-DETAIL-"+this.prevDetailView.toUpperCase()+"-CLOSE",{timeSpent:(Date.now()-this.detailTagTime)/1E3});this.tagEvent(this.device+"-DETAIL-"+a.toUpperCase()+"-OPEN",{loadTime:b});this.prevDetailView=a;this.detailTagTime=
Date.now()});function saveUserPic(){navigator.camera.getPicture(onPicSuccess,onPicFail,{quality:50})}function showContactPicture(a){a=(a=StorageManager.getLocalValue(a+"__pic"))?"data:image/jpeg;base64,"+a:staticRsrcUrl+"/images/userPicwBorder.png";$j("#photo_div img").attr("src",a)}
function onPicSuccess(a){ManageUserSession.getApiClient().addAttachment("ContactViewer-UserPhoto",listView.selectedContactId,a);StorageManager.setLocalValue(listView.selectedContactId+"__pic",a);showContactPicture(listView.selectedContactId)}function onPicFail(a){console.log("Pic Failed because: "+a)}
$j(function(){$j("#photo_div img").enableTap().click(saveUserPic);if(typeof sforce.Client!="undefined")sforce.Client.prototype.addAttachment=function(a,b,c,d,e,f){var g=getBaseUrl()+"/services/apexrest/cvapi?action=insertSObject&sobject=Attachment";this.ajax("POST",g,{Name:a,ParentId:b,Body:c},d,e,f)}});