/* Copyright (c) 2011, salesforce.com <http://salesforce.com> , inc.*/
void 0===window.$j&&($j=$.noConflict());var sforce=window.sforce;void 0===sforce&&(sforce={});String.prototype.startsWith=function(a){return this.substr(0,a.length)===a};String.prototype.endsWith=function(a){return this.substr(this.length-a.length,this.length)===a};Array.prototype.last=function(){return this[this.length-1]};function htmlEncode(a){return a?$j("<div/>").text(a).html():a}function htmlDecode(a){return a?$j("<div/>").html(a).text():a}
function formatStr(a,b){a&&(a=htmlEncode(a));return a&&b&&a.length>b?a.substr(0,b-3)+"...":a}function cleanupPhone(a){return a?(a=htmlEncode(a),(a.trim().startsWith("+")?"+":"")+a.replace(/[^0-9]/g,"")):a}
function formatAddress(a){return(a.MailingStreet?htmlEncode(a.MailingStreet).replace(/\n/g,", ")+"\n":"")+(a.MailingCity?htmlEncode(a.MailingCity).replace(/\n/g,", ")+", ":"")+(a.MailingState?htmlEncode(a.MailingState).replace(/\n/g,", ")+" ":"")+(a.MailingPostalCode?htmlEncode(a.MailingPostalCode).replace(/\n/g,", ")+" ":"")+(a.MailingCountry?htmlEncode(a.MailingCountry).replace(/\n/g,""):"")}function getBaseUrl(){return siteUrl.endsWith("/")?siteUrl.substring(0,siteUrl.length-1):siteUrl}
function getFieldDescribe(){return eval("("+StorageManager.getSessionValue(contact_describe_storage_key)+")")}function truncateLongText(){}function isPortrait(){return window.innerHeight>window.innerWidth}var contact_describe_storage_key="SFDC-CONTACT-DESCRIBE";
function fetchContactDescribe(a){ManageUserSession.getApiClient().describeContactViaApex(function(a){contactLabel=a.label||"Contact";contactPluralLabel=a.labelPlural||"Contacts";if(a.fields){var c={};$j.each(a.fields,function(){var a={label:this.label,type:this.type,length:this.length};c[this.name]=a;"reference"==a.type&&(a.relationshipName=this.relationshipName,a.referenceTo=this.referenceTo,a.relationshipLabel=this.relationshipLabel||"",c[this.relationshipName]=a)});StorageManager.setSessionValue(contact_describe_storage_key,
JSON.stringify(c))}a.recordTypeInfos&&1<a.recordTypeInfos.length&&(hasRecordTypes=!0);a.childRelationships&&(hasChatterEnabled=a.childRelationships.some(function(a){return"ContactFeed"==a.childSObject}))},errorCallback,function(b,c){"function"==typeof a&&a("success"==c)})}
function createScroller(a,b,c){var d,e,f,g,a="object"==typeof a?a:$j("#"+a);if(b){var h=a.find("#pullDown")[0];h||($j(a.children().children().get(0)).before('<div id="pullDown"><span class="app-images appleui pullDownIcon"></span><span class="pullDownLabel">Pull down to refresh</span> </div>'),h=a.find("#pullDown")[0]);d=h.offsetHeight;e=function(){if(h.className.match("loading")){h.className="";h.querySelector(".pullDownLabel").innerHTML="Pull down to refresh"}};f=function(){if(this.y>5&&!h.className.match("flip")){h.className=
"flip";h.querySelector(".pullDownLabel").innerHTML="Release to refresh";this.minScrollY=0}else if(this.y<5&&h.className.match("flip")){h.className="";h.querySelector(".pullDownLabel").innerHTML="Pull down to refresh";this.minScrollY=-d}};g=function(){if(h.className.match("flip")){h.className="loading";h.querySelector(".pullDownLabel").innerHTML="Loading...";b()}}}var j={useTransition:!0,topOffset:d||0};c&&c.onBeforeScrollStart&&(j.onBeforeScrollStart=c.onBeforeScrollStart);e&&(j.onRefresh=e);f&&(j.onScrollMove=
f);g&&(j.onScrollEnd=g);return new iScroll(a[0],j)}
function errorCallback(a,b){if("error"==b){var c=a.responseText;try{c=$j.parseJSON(c)}catch(d){}switch(a.status){case 403:if(/NO_API_ACCESS/gi.test(a.responseText)&&ManageUserSession.isActive()){alert(c.message);logout(!0);break}case 401:alert(c.message||"Session expired. Please relogin.");ManageUserSession.invalidate(!0,function(){window.location.reload()});break;default:alert("Server Unavailable. Check network connection or try again later.")}}else b="timeout",alert("Session timed out."),ManageUserSession.invalidate(!0,
function(){window.location.reload()})}var last_visited_loc_storage_key="LAST-VISIT-LOC";function updateLastVisitLoc(a){a?StorageManager.setLocalValue(last_visited_loc_storage_key,a):StorageManager.clearLocalValue(last_visited_loc_storage_key)}
function getEulaResponse(a){SettingsManager.showEula(function(){ManageUserSession.getApiClient().submitEulaResponse(ManageUserSession.getClientId(),this.id,function(b){b.success&&"true"==b.success?(ManageUserSession.updateEula(!0),SettingsManager.hideEula(),"function"==typeof a&&a()):(b.error&&alert(b.error),b.errorCode&&"INVALID_CLIENT"==b.errorCode&&logout(!1))},errorCallback)},function(){logout(!0)})}
function logout(a){ManageUserSession.kill(function(){a||StorageManager.setSessionValue(login_redirect_storage_key,!1);window.location=getBaseUrl()})}
function getContacts(a,b){listView.showBusyIndicator("Loading...");ManageUserSession.getApiClient().queryContactsViaApex(a,function(a){sobjectModel.setRecords(a.records)},errorCallback,function(c,d){listView.updateList(sobjectModel.records);listView.hideBusyIndicator();listView.refreshScroller(function(){getContacts(a)});"function"==typeof b&&b("success"==d)})}
function searchContacts(a,b){listView.showBusyIndicator("Searching...");ManageUserSession.getApiClient().searchContactsViaApex(a,function(a){sobjectModel.setRecords(a)},errorCallback,function(c,d){listView.updateList(sobjectModel.records);listView.hideBusyIndicator();listView.refreshScroller(function(){searchContacts(a)});"function"==typeof b&&b(d)})}
function prepareSession(a){"false"==StorageManager.getSessionValue(login_redirect_storage_key)?(StorageManager.clearSessionValue(login_redirect_storage_key),setTimeout(SettingsManager.show,10)):ManageUserSession.initialize(function(){ManageUserSession.isEulaAccepted()?sessionCallback():getEulaResponse(sessionCallback)},a)}
void 0===sforce.Client&&(sforce.Client=function(){this.sessionHeader=null;this.SESSION_HEADER="App-Session"},sforce.Client.prototype.ajax=function(a,b,c,d,e,f){var g=this;$j.ajax({type:a,url:b,processData:!0,data:c,dataType:"json",success:d,error:e,complete:f,beforeSend:function(a){g.sessionHeader&&a.setRequestHeader(g.SESSION_HEADER,g.sessionHeader)}})},sforce.Client.prototype.setSessionHeader=function(a){this.sessionHeader=a},sforce.Client.prototype.getAuthorizeUrl=function(a){return getBaseUrl()+
"/services/apexrest/oauth2/?doAuthorize&host="+a},sforce.Client.prototype.refreshAccessToken=function(a,b,c,d,e,f){var g=getBaseUrl()+"/services/apexrest/oauth2/refreshAccess";this.ajax("POST",g,"rt="+c+"&pass="+a+"&cid="+b,d,e,f)},sforce.Client.prototype.obtainAccessToken=function(a,b,c,d,e,f){var g=getBaseUrl()+"/services/apexrest/oauth2/authenticate";this.ajax("POST",g,"code="+b+(c?"&pass="+c:"")+(a?"&host="+a:""),d,e,f)},sforce.Client.prototype.prepareSession=function(a,b,c){var d=getBaseUrl()+
"/services/apexrest/oauth2/prepareSession";this.ajax("POST",d,null,a,b,c)},sforce.Client.prototype.prepareSessionFromOAuth=function(a,b,c,d,e,f){var g=getBaseUrl()+"/services/apexrest/oauth2/prepareSession";this.ajax("POST",g,"accessToken="+a+"&instanceUrl="+b+"&identityUrl="+c,d,e,f)},sforce.Client.prototype.revokeSession=function(a,b,c,d,e){var f=getBaseUrl()+"/services/apexrest/oauth2/revokeSession";this.ajax("POST",f,a&&b?"cid="+a+"&rt="+b:"",c,d,e)},sforce.Client.prototype.queryContactsViaApex=
function(a,b,c,d){var e=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",e,"action=fetchContacts&filter="+a,b,c,d)},sforce.Client.prototype.retrieveContactViaApex=function(a,b,c,d,e){var f=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",f,"action=retrieveContact&id="+a+"&fields="+b,c,d,e)},sforce.Client.prototype.searchContactsViaApex=function(a,b,c,d){var e=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",e,"action=searchContacts&text="+a,b,c,d)},sforce.Client.prototype.fetchChatterViaApex=
function(a,b,c,d){var e=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",e,"action=fetchChatter&ids="+a,b,c,d)},sforce.Client.prototype.fetchActivitiesViaApex=function(a,b,c,d){var e=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",e,"action=fetchActivities&ids="+a,b,c,d)},sforce.Client.prototype.getUsersInfoViaApex=function(a,b,c,d,e){var f=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",f,"action=getUsersInfo&id="+a+"&fetchPhotos="+b,c,d,e)},sforce.Client.prototype.describeContactViaApex=
function(a,b,c){var d=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",d,"action=describeContact",a,b,c)},sforce.Client.prototype.getContactDetailsViaApex=function(a,b,c,d,e){var f=this,g=getBaseUrl()+"/ContactDetails",h=(new Date).getTimezoneOffset();$j.ajax({type:"GET",url:g,data:"id="+a+"&rtid="+(b||"")+"&tzOffset="+h,success:c,error:d,complete:e,beforeSend:function(a){f.sessionHeader&&a.setRequestHeader(f.SESSION_HEADER,f.sessionHeader)}})},sforce.Client.prototype.getContactAppEula=function(a,
b,c){var d=getBaseUrl()+"/ContactsAppEula";$j.ajax({type:"GET",url:d,success:a,error:b,complete:c})},sforce.Client.prototype.submitEulaResponse=function(a,b,c,d,e){var f=getBaseUrl()+"/services/apexrest/cvapi";this.ajax("GET",f,"action=manageEula&clientId="+a+"&eulaResponse="+b,c,d,e)});
var SettingsManager=function(){function a(c){if(c&&e!=c){d&&h();d=createScroller(b.find(".settings_body "+c));e=c;$j(window).orientationChange(function(){a()})}else d&&d.refresh()}var b,c,d,e,f,g=false,h=function(){if(d){d.destroy();e=d=void 0}},j=function(){var a=ManageUserSession.getLoginHostType();if(!a){a=b.find("#hosts table td")[0].id;ManageUserSession.setLoginHostType(a)}if(a){b.find("#connection #hostType #name").text(b.find("#hosts #"+a+" span").text());b.find("#hosts table td").css("color",
"black");b.find("#hosts #"+a).css("color","#395483").append(b.find("#hosts #check"))}b.find("#main #connection #host_url input").val(ManageUserSession.getLoginHostUrl())},k=function(c,d){ManageUserSession.getApiClient().getContactAppEula(function(a){a=$j(a);a.find("head, script").remove();b.find("#eula .content").empty().append(a);if(c){a=b.find("#eula_buttons").show();b.find("#eula").css("margin-bottom",a.outerHeight()+"px")}else b.find("#eula").css("margin-bottom","0")},errorCallback,function(b,
c){a("#eula");typeof d=="function"&&d(c)})},l=function(c,d,e,f){var k=$j(this),h;g&&setTimeout(function(){b.find("#main #connection #host_url input").blur()},10);k.addClass("cellselected");b.find("#header #done").hide();h=function(){k.removeClass("cellselected");b.find("#main").css("visibility","hidden");typeof f=="function"&&f()};if(useAnimations)b.find("#main").changePage(b.find(c),false,h);else{b.find("#main").hide();b.find(c).show().css("visibility","");h()}b.find("#header #title").text(d);a(c);
if(e){var l=b.find(c);b.find("#header #left").show().touch(function(){b.find("#header #left").hide().off();if(useAnimations)l.changePage(b.find("#main"),true,function(){l.css("visibility","hidden")});else{l.hide();b.find("#main").show().css("visibility","")}b.find("#header #title").text("Settings");ManageUserSession.isActive()&&b.find("#header #done").show();a("#main")})}},o=function(){b.positionCenterOf(window)};return{show:function(){var d,e;if(!c){c=true;b=$j("#app_settings");b.find("#main #connection #hostType").enableTap().click(function(){l("#hosts",
"Login Host",true,void 0)});b.find("#hosts table td").enableTap().click(function(){var a=$j(this);a.addClass("cellselected");ManageUserSession.setLoginHostType(this.id);j();setTimeout(function(){a.removeClass("cellselected")},100)});b.find("#main #connection #host_url input").focus(function(){g=true;$j(this).css("text-align","left")}).blur(function(){g=false;$j(this).val(ManageUserSession.getLoginHostUrl());$j(this).css("text-align","right");setTimeout(function(){$j(document.body).scrollTop(0)},10)});
b.find("#main #connection #host_url form").submit(function(){var a=b.find("#main #connection #host_url input"),c=b.find("#main #connection #host_url input").val().trim();(c=c.length==0||c.endsWith(".salesforce.com"))||alert('Custom host url must end with ".salesforce.com".');if(c){ManageUserSession.setLoginHostUrl(a.val());j();a.blur()}return false});b.find("#main #help #help_about").enableTap().click(function(){l("#about","About",true,void 0)});b.find("#main #help #help_faq").enableTap().click(function(){l("#faq",
"FAQ",true,function(){})});b.find("#main #help #help_eula").enableTap().click(function(){l("#eula","Contact Viewer EULA",true,k)});b.find("#loginbtn").off().enableTap().click(function(){prepareSession()});b.find("#logoutbtn").off().enableTap().click(function(){confirm("Logout user "+ManageUserSession.getUsername()+"?")&&logout(false)})}j();b.find("#header #title").text("Settings");b.find(".page").css("visibility","hidden");b.find("#main").css("visibility","visible");b.width()<500&&b.find("#header #left>div").text("Back");
if(ManageUserSession.isActive()){b.find("#header #done").show();b.find("#loginbtn").hide();b.find("#logoutbtn").show()}else{b.find("#loginbtn").show();b.find("#logoutbtn").hide()}f=$j("#loggedin").addOverlay();b.find("#username").setText(ManageUserSession.getUsername()||"None");b.find("#header #done").off("click").enableTap().click(function(){SettingsManager.hide();$j(this).off("click");if(!ManageUserSession.isActive())window.location=getBaseUrl()});ManageUserSession.isActive()||b.find("#header #done").hide();
d=window.innerHeight;e=(window.innerHeight-b.height())/2;b.hide().css("zIndex",$j.topZIndex(f.elem)+10).css({left:(window.innerWidth-b.width())/2});useAnimations?b.css({top:0}).show().slideIn("Y",d,e):b.css({top:e}).show();a("#main");b.orientationChange(o)},hide:function(a){var c=window.innerHeight,d=function(){b.hide();f.hide();typeof a=="function"&&a()};useAnimations?b.slideOut("Y",c,d):d();h();b.unbindOrientationChange(o)},showEula:function(a,c){SettingsManager.show();l("#eula","End User License Agreement",
false,function(){k(true);var d=b.find("#eula_buttons").show();d.find("#accept").off().enableTap().click(a);d.find("#decline").off().enableTap().click(c)})},hideEula:function(){SettingsManager.hide(function(){if(useAnimations)b.find("#eula").changePage(b.find("#main"),true);else{b.find("#eula").hide();b.find("#main").show().css("visibility","")}b.find("#eula").css("visibility","hidden");b.find("#eula_buttons").hide();b.find("#header #title").text("Settings")})}}}(),FeedPhotoRenderer=function(){this.userIds=
[]};FeedPhotoRenderer.prototype.getImage=function(a){this.userIds.push(a);return'<img class="feedImage app-images" id="photo__'+escape(a)+'"/>'};FeedPhotoRenderer.prototype.renderImages=function(a){if(this.userIds.length!=0){a||(a=$j(document.body));hasChatterEnabled&&ManageUserSession.getApiClient().getUsersInfoViaApex(this.userIds,hasChatterEnabled,function(b){$j.each(b.records,function(){a.find("#photo__"+escape(this.Id)).removeClass("app-images").attr("src",this.SmallPhotoUrl)})},errorCallback)}};
function feedRenderer(a,b,c){var d=$j("#feedscroller #feed"),e=d.find("ul");e.empty();d.find("div").remove();if(!a||a.length==0)d.append($j('<div style="padding-top:20px"></div>').text(b));else{var f=new FeedPhotoRenderer,g=getFieldDescribe();$j.each(a,function(){var a=this.attributes.type;a=="ContactFeed"?generateChatterItem(this,e,f,g,c):a=="Task"&&generateTaskItem(this,e,f,c)});f.renderImages(e)}}
function generateChatterItem(a,b,c,d,e){var f=a.Body||"";a.Type=="TrackedChange"&&(a.FeedTrackedChanges&&a.FeedTrackedChanges.records)&&$j.each(a.FeedTrackedChanges.records,function(){if(this.FieldName=="created")f="created this "+contactLabel.toLowerCase()+".";else if(this.FieldName=="contactUpdatedByLead")f="updated this "+contactLabel.toLowerCase()+" by converting a lead.";else if(this.FieldName=="contactCreatedFromLead")f="converted a lead to this "+contactLabel.toLowerCase()+".";else if(this.NewValue!=
null||this.OldValue!=null){var a;if(a=d[this.FieldName.split(".")[1]]){a=a.label;f="updated "+a+" from "+(this.OldValue||"blank")+" to "+(this.NewValue||"blank")}}});if(f&&f.length>0){var g;if(e&&e.includeParent){g=$j('<span style="font-weight:bold"></span>').text(a.Parent.Name);g=$j('<a href="#"/>').attr("id","contact_"+htmlEncode(a.Parent.Id)).append(g);g[0].onclick=e.onClickParent}e=$j('<div class="feedBody"></div>').append(g).append(g?"&nbsp;-&nbsp;":"").append($j("<strong></strong>").text(a.CreatedBy.Name)).append("&nbsp;").append($j("<span></span>").text(f)).append('<br/><span class="datetime">'+
$j.format.date(a.CreatedDate,"MMM dd, yyyy (at) hh:mm a")+"</span>");$j("<li></li>").append(c.getImage(a.CreatedBy.Id)).append(e).appendTo(b)}}
function generateTaskItem(a,b,c,d){var e;if(d&&d.includeParent){e=$j('<span style="font-weight:bold"></span>').text(a.Who.Name);e=$j('<a href="#"/>').attr("id","contact_"+htmlEncode(a.Who.Id)).append(e);e[0].onclick=d.onClickParent}d=$j('<div class="feedBody"></div>').append(e).append(e?"&nbsp;-&nbsp;":"").append($j("<strong></strong>").text(a.Owner.Name)).append(" "+(a.IsClosed?"completed":"owns")+" the task<br/>").append($j("<span></span>").text(a.Subject||"")).append('<br/><span class="datetime">'+
(a.ActivityDate?"Due on "+$j.format.date(a.ActivityDate,"MMM dd, yyyy"):"No Due Date.")+"</span>");$j("<li></li>").append(c.getImage(a.Owner.Id)).append(d).appendTo(b)}
void 0===sforce.ListView&&(sforce.ListView=function(a){this.options={onListSelect:null,onSearch:null,onItemSelect:null,listTypes:{owner:"My Records",follow:"Records I Follow",recent:"Recently Viewed"}};for(i in this.options)this.options[i]=a[i];this.selectedContactId=a.selectedContactId;this.view=$j("#listpage");this._init()},sforce.ListView.prototype={_init:function(){var a=this,b=function(b){var d=a.view.find("#header #listselect");d.on("webkitTransitionEnd",function(){b&&b.hide();a.view.find("#header #searchbar").show();
d.off("webkitTransitionEnd").hide();d.css("zIndex","");d.prev().css("zIndex","");a.showingListSelector=false});d.css("-webkit-transform","translateY(-"+d.height()+"px)")};a._addSearchListeners();a.view.find("#header #titlebar").off().enableTap().click(function(){if(!a.showingListSelector){a.showingListSelector=true;var c=a.view.find("#header #listselect"),d=a.view.find("#listscroller").addOverlay(),e=$j.topZIndex(d.elem);c.prev().css("zIndex",e+2);c.css("zIndex",e+1);c.css(vendor+"TransitionProperty",
"").css("-webkit-transform","translateY(-"+c.height()+"px)");c.css(vendor+"TransitionProperty","-webkit-transform").css("visibility","hidden").show("fast",function(){a.view.find("#header #searchbar").hide();c.css("visibility","").css("-webkit-transform","translateY(0px)");c.find("button").windowTouch(function(c){c.preventDefault();c=c.target;a.view.find("#header #searchbar>form>input[type=search]").val("");a.view.find("#header #searchbar>form>button").hide();b(d);a.displayList(c.id);return true},
function(a){var c=a.target;if(c.nodeType==3)c=c.parentNode;var e=$j("#listpage");($j(c).is(e)||e.has(c).length>0)&&a.preventDefault();b(d);return true},true)})}});a.view.find("#listscroller #scroller #contactlist").off().enableTap().click(function(b){var d=b.target;if(!a.loadingItem){d=$j(d).closest("li",a.view);b.preventDefault();d.length&&(!d.hasClass("listseparater")&&typeof a.options.onItemSelect=="function")&&a.selectContact(d[0].id.substring(8))}})},_addSearchListeners:function(){var a=this,
b=function(){var a=$j(this);a.val().length>0?a.next().show():a.next().hide()};a.view.find("#header #searchbar>form").submit(function(){var b=$j(this).find("input[type=search]").blur().val(),b=b.trim();if(b.length>1&&!b.startsWith("*")){a.searchTextLength=b.length;a.listFetchStartTime=Date.now();a.mode="search";a.view.find("#header #titlebar #title").html("Search Results");if(typeof a.options.onSearch=="function")a.options.onSearch(b)}return false});a.view.find("#header #searchbar>form>input[type=search]").focusin(function(){var a=
$j(this);a.windowTouch(function(){return false},function(){a.blur();return true},false)}).on("keydown",b).on("keyup",b);a.view.find("#header #searchbar #closebutton").off().enableTap().click(function(b){b.preventDefault();$j(this).hide().prev().val("").blur();if(a.mode=="search"){a.displayList(a.selectedListId);a.mode="list"}})},_initiateContactListScroller:function(a){var b=this;if(typeof a=="function")b.contactListPullDownCB=a;if(b.listpagescroll===void 0){b.listpagescroll=createScroller("listscroller",
function(){typeof b.contactListPullDownCB=="function"&&b.contactListPullDownCB()});$j(window).orientationChange(b._initiateContactListScroller)}else b.listpagescroll&&b.listpagescroll.refresh()},displayList:function(a,b){var c;this.listFetchStartTime=Date.now();c=a?this.view.find("#header #listselect button#"+a):this.view.find("#header #listselect button#recent");this.view.find("#header #titlebar #title").text(c.text());this.selectedListId=c[0].id;if(typeof this.options.onListSelect=="function")this.options.onListSelect(this.selectedListId,
b)},updateList:function(a){var b=this,c=b.view.find("#listscroller #scroller #contactlist"),d=b.view.find("#listscroller #scroller #resultCount");c.empty();d.empty();!a||a.length==0?d.text("No "+contactPluralLabel+" Found"):d.text("Found "+a.length+" "+contactPluralLabel);a.sort(function(a,b){var c=a.LastName.toLowerCase(),d=b.LastName.toLowerCase();return c==d?0:c>d?1:-1});var e=[];$j.each(a,function(){var a=htmlEncode(this.Id);if(e.length==0||this.LastName!=null&&e.last()!=this.LastName[0].toUpperCase()){e.push(this.LastName[0].toUpperCase());
$j("<li></li>").addClass("listseparater").text(e.last()).appendTo(c)}var d=$j("<li></li>").attr("id","contact_"+a);a==b.selectedContactId&&d.addClass("cellselected");d.text((this.FirstName||"")+" ").append($j("<strong></strong>").text(this.LastName||"")).appendTo(c)});b.mode=="search"?LocalyticsManager.tagSearch(b.searchTextLength,a.length,Date.now()-b.listFetchStartTime):LocalyticsManager.tagListView(this.selectedListId,a.length,Date.now()-b.listFetchStartTime)},resetSelectedContact:function(){this.selectedContactId=
null;this.view.find("#contactlist .cellselected").removeClass("cellselected")},selectContact:function(a){var b=this;b.resetSelectedContact();b.selectedContactId=a;b.view.find("#contactlist li#contact_"+a).addClass("cellselected");b.loadingItem=true;b.options.onItemSelect(b.selectedContactId,function(){b.loadingItem=false})},showBusyIndicator:function(a){this.busyInd=this.view.find("#listscroller").showActivityInd(a)},hideBusyIndicator:function(){this.busyInd&&this.busyInd.hide()},refreshScroller:function(a){this._initiateContactListScroller(a)}});
var ManageUserSession=function(){function a(a){f=true;g=a.username;h=a.eula;e.setSessionHeader(a.sessionToken);StorageManager.setSessionValue(d,a.sessionToken)}function b(){var a;switch(ManageUserSession.getLoginHostType()){case "host_production":a="login.salesforce.com";break;case "host_sandbox":a="test.salesforce.com";break;case "host_custom":a=StorageManager.getLocalValue(c)}if(!a||a.length==0)a="login.salesforce.com";return a}var c="SFDC-LOGIN-HOST-URL",d="SFDC-SESSION-TOKEN",e,f,g,h,j="standalone"in
navigator&&navigator.standalone;return{isActive:function(){return f==true},isEulaAccepted:function(){return h==true},updateEula:function(a){h=a},getClientId:function(){return f?StorageManager.getLocalValue("SFDC-CLIENT-ID"):null},getUsername:function(){return f?g:null},getApiClient:function(){return f?e:null},getLoginHostType:function(){return StorageManager.getLocalValue("SFDC-LOGIN-HOST")},getLoginHostUrl:b,setLoginHostType:function(a){a!=ManageUserSession.getLoginHostType()&&StorageManager.setLocalValue("SFDC-LOGIN-HOST",
a)},setLoginHostUrl:function(a){a=a.toLowerCase();if(b()!=a){var d="host_custom";switch(a){case "login.salesforce.com":d="host_production";break;case "test.salesforce.com":d="host_sandbox"}StorageManager.setLocalValue(c,a);ManageUserSession.setLoginHostType(d)}},initialize:function(b,c){e||(e=new sforce.Client);var g=StorageManager.getSessionValue(d),h=StorageManager.getLocalValue("SFDC-OAUTH-TOKEN");if(f)b();else if(g&&g.length>0){e.setSessionHeader(g);var m=function(){e.setSessionHeader(null);StorageManager.clearSessionValue(d);
ManageUserSession.initialize(b)};e.prepareSession(function(c){if(c.success){a(c);typeof b=="function"&&b()}else m()},m)}else if(h&&h.length>0)PasscodeManager.checkPasscode(function(c,d){if(c==-1)confirm("Logout user?")?logout(true):typeof d=="function"&&d(false);else{var f=$j(document).showActivityInd("Authenticating...",false),g=StorageManager.getLocalValue("SFDC-CLIENT-ID"),l=StorageManager.getLocalValue("SFDC-OAUTH-TOKEN");e.refreshAccessToken(c,g,l,function(c){if(c.success){a(c);typeof d=="function"&&
d(true);typeof b=="function"&&b()}else{c.errorCode=="INVALID_TOKEN"&&StorageManager.clearAll();typeof d=="function"&&d(c.success,c.error)}},function(a,b){typeof d=="function"&&d(false,b=="error"?"Server Unavailable. Check network connection or try again later.":"Request timed out. Please try again.")},f.hide)}});else if(window.location.search.indexOf("code=")>0){var p=/code=([^&]*)&?/.exec(window.location.search)[1],n=function(){history.pushState(null,null,window.location.pathname);b()},g=function(b,
c){var b=b==-1?void 0:b,d=$j(document).showActivityInd(b?"Setting Passcode...":"Authenticating...",false);e.obtainAccessToken(ManageUserSession.getLoginHostUrl(),p,b,function(e){d.hide();if(e.success){a(e);var f=e.clientId,e=b?e.refreshToken:null;f&&f.length>0&&StorageManager.setLocalValue("SFDC-CLIENT-ID",f);e&&e.length>0&&StorageManager.setLocalValue("SFDC-OAUTH-TOKEN",e);typeof n=="function"&&n()}else alert(e.error);typeof c=="function"&&c()},function(){if(confirm("Failed to obtain access. Try again!"))window.location=
e.getAuthorizeUrl(ManageUserSession.getLoginHostUrl())})};j?PasscodeManager.setupPasscode(g):g()}else{typeof c=="boolean"&&c&&StorageManager.clearAll();window.location=e.getAuthorizeUrl(ManageUserSession.getLoginHostUrl())}},invalidate:function(a,b){a&&f&&e.revokeSession(null,null,null,null,b);StorageManager.clearSessionValue(d);e=f=g=void 0},kill:function(a){var b=StorageManager.getLocalValue("SFDC-CLIENT-ID"),c=StorageManager.getLocalValue("SFDC-OAUTH-TOKEN");e.revokeSession(b,c,null,null,function(){ManageUserSession.invalidate();
StorageManager.clearAll();typeof a=="function"&&a()})}}}(),PasscodeManager=function(){var a,b,c=function(){var b=$j(window).height()/2-a.passcodeElem.outerHeight()/2,c=$j(window).width()/2-a.passcodeElem.outerWidth()/2;a.passcodeElem.css("top",b+"px").css("left",c+"px")},d=function(){if(window.innerHeight>window.innerWidth){var b=$j(window).height()-$j("#passcode table").outerHeight()+"px";a.passcodeElem.css("visibility","hidden").css("opacity","1").css(vendor+"Transform","translateY("+$j(window).height()+
"px)").show();a.passcodeElem.addClass("passcodeTransition").css("visibility","").css(vendor+"TransitionProperty","-"+vendor.toLowerCase()+"-transform");a.passcodeElem.css(vendor+"Transform","translateY("+b+")")}else{a.passcodeElem.css("visibility","hidden");setTimeout(function(){alert("Please switch to portrait mode to enter the passcode.")},0)}},e=function(){a.passcodeElem.css("opacity","0").show();setTimeout(function(){var b=Math.min(window.innerWidth,window.innerHeight);if(/ipad/gi.test(navigator.platform)||
b>$j("#passcode table").outerHeight()){a.passcodeElem.css("opacity","0");c();a.passcodeElem.addClass("passcodeTransition").css(vendor+"TransitionProperty","opacity").css("opacity","1");a.passcodeElem.orientationChange(c)}else{a.passcodeElem.orientationChange(d);d()}},0)},f=function(){var b;a.passcodeElem.bind("webkitTransitionEnd",function(){a.passcodeElem.removeClass("passcodeTransition").css(vendor+"TransitionProperty","none");a.passcodeElem.hide().unbind("webkitTransitionEnd");a&&a.passcodeElem&&
a.passcodeElem.unbindOrientationChange(c);a=void 0});if(/ipad/gi.test(navigator.platform)||$j(window).width()>$j("#passcode table").outerWidth()+50){b=void 0;a.passcodeElem.addClass("passcodeTransition").css(vendor+"TransitionProperty","opacity").css("opacity","0")}else{b=$j(window).height()+"px";a.passcodeElem.addClass("passcodeTransition").css(vendor+"TransitionProperty","-"+vendor.toLowerCase()+"-transform");a.passcodeElem.css(vendor+"Transform","translateY("+b+")")}},g=function(c){a={passcodeElem:$j("#passcode"),
inputElems:$j("#passcode #passcode_input input"),elemNum:0,passcode:"",callback:c};if(b===void 0){a.passcodeElem.find("table td.passcode_button").each(function(){var b=$j(this),c=b.text();b.touch(function(d){d.preventDefault();d.stopPropagation();if(a.elemNum<4){$j(b).addClass("pressed");setTimeout(function(){$j(b).removeClass("pressed")},100);if(c=="Logout"||c=="Cancel")a.callback(-1);else if(c=="Delete"){if(a.elemNum>0){a.inputElems[--a.elemNum].value="";a.passcode=a.passcode.substr(0,a.elemNum)}}else if(parseInt(c)>=
0){a.inputElems[a.elemNum++].value=".";a.passcode=a.passcode+c}a.elemNum==4&&a.callback&&a.callback(a.passcode)}})});b=true}k(a.title);h()},h=function(){k("Enter Passcode");$j("#passcode #passcode_message").empty().hide();$j("#passcode #passcode_header").removeClass("passcode_error");j()},j=function(){a.elemNum=0;a.passcode="";a.inputElems.val("")},k=function(a){$j("#passcode #passcode_title").html(a)};return{checkPasscode:function(b,c){g(function(a){var d=function(a,b){if(a){f();typeof c=="function"&&
c()}else{j();if(b){k("Wrong Passcode");$j("#passcode #passcode_message").html(b).show();$j("#passcode #passcode_header").addClass("passcode_error")}}};b&&b(a,d)});a.passcodeElem.find("#cancel").text("Logout");e()},setupPasscode:function(b){var c;g(function(d){if(d==-1){f();typeof b=="function"&&b(-1)}else if(c)if(c==d)typeof b=="function"&&b(a.passcode,f);else{c=void 0;alert("Passcode didn't match. Please try again.");h()}else{c=d;k("Re-enter the passcode");j()}});k("Setup Passcode");a.passcodeElem.find("#cancel").text("Cancel");
e()}}}();
void 0===sforce.SplitView&&(sforce.SplitView=function(){this.callbacks=$j.Callbacks();this._init()},sforce.SplitView.prototype={_init:function(){var a=this;isPortrait=function(){return window.innerHeight>window.innerWidth};var b=function(){switch(isPortrait()){case true:$j("#listpage").appendTo("#popover");$j("#popover").css("visibility","hidden").css("opacity","0").show();$j("#contactlist_button").show().text(contactPluralLabel).touch(function(){$j("#popover,#contactlist_button").windowTouch(function(){return false},function(){a.focusOutContactList();
return true},false);$j("#popover").css("visibility","").css("opacity","1")});break;case false:$j("#popover").hide();$j("#rightsection").before($j("#listpage"));$j("#contactlist_button").hide().unbindTouch();$j("#popover,#contactlist_button").unbindWindowTouch()}a.callbacks.fire(isPortrait())};$j(window).orientationChange(function(){(isPortrait()&&$j("#listpage").parent()[0].id!="popover"||!isPortrait()&&$j("#listpage").parent()[0].id=="popover")&&b()});b()},focusOutContactList:function(){switch(window.innerHeight>
window.innerWidth){case true:var a=$j("#popover"),b=function(){a.css("visibility","hidden").unbind("webkitTransitionEnd")};a.css("opacity")!="0"&&a.bind("webkitTransitionEnd",b);a.css("opacity","0");$j("#popover,#contactlist_button").unbindWindowTouch()}},addOrientationChangeCallback:function(a){typeof a=="function"&&this.callbacks.add(a)},removeOrientationChangeCallback:function(a){typeof a=="function"&&this.callbacks.remove(a)}});
var StorageManager=function(){return{checkLocalStorage:function(){return typeof localStorage=="undefined"?false:true},checkSessionStorage:function(){return typeof sessionStorage=="undefined"?false:true},clearAll:function(){this.checkLocalStorage()&&localStorage.clear();this.checkSessionStorage()&&sessionStorage.clear()},setLocalValue:function(a,b){this.checkLocalStorage()&&localStorage.setItem(a,b)},getLocalValue:function(a){if(this.checkLocalStorage())return localStorage.getItem(a)},clearLocalValue:function(a){this.checkLocalStorage()&&
localStorage.removeItem(a)},setSessionValue:function(a,b){this.checkSessionStorage()&&sessionStorage.setItem(a,b)},getSessionValue:function(a){if(this.checkSessionStorage())return sessionStorage.getItem(a)},clearSessionValue:function(a){this.checkSessionStorage()&&sessionStorage.removeItem(a)}}}();
void 0===window.LocalyticsManager&&(window.LocalyticsManager=function(){localyticsSession.init(localyticsAppId);localyticsSession.open();localyticsSession.upload();this.uploadTimer=setInterval(localyticsSession.upload,3E4)},window.LocalyticsManager());
void 0!=window.LocalyticsManager&&function(){var a=function(a){return a<100?"< 100":a<200?"100 - 200":a<500?"200 - 500":"> 500"},b=function(a){return a<500?"< 0.5s":a<1E3?"0.5 - 1s":a<2E3?"1 - 2s":"> 2s"};LocalyticsManager.tagScreen=function(){};LocalyticsManager.tagSplitView=function(){};LocalyticsManager.tagPortraitView=function(){};LocalyticsManager.tagEvent=function(a,b){localyticsSession.tagEvent(a,b)};LocalyticsManager.tagListView=function(c,d,e){this.tagEvent("Render List",{list:c,resultsetSize:a(d),
loadTimeRange:b(e),loadTime:e})};LocalyticsManager.tagSearch=function(c,d,e){this.tagEvent("Search",{textLength:c<3?"< 3":c<5?"3 - 5":"> 5",resultsetSize:a(d),loadTimeRange:b(e),loadTime:e})};LocalyticsManager.tagDetailView=function(a,d){this.tagEvent("Render Detail",{view:a,loadTimeRange:b(d),loadTime:d})}}();