/*Copyright (c) 2011, salesforce.com <http://salesforce.com> , inc.*/Â 
var login_redirect_storage_key="SFDC-LOGIN-REDIRECT",feedpagescroll,infopagescroll,hasRecordTypes=!1,hasChatterEnabled=!1,contactLabel="Contact",contactPluralLabel="Contacts",listView,splitView,sobjectModel;function initiateInfoScroller(){void 0===infopagescroll?(infopagescroll=createScroller("infoscroller"),$j(window).orientationChange(initiateInfoScroller)):infopagescroll.refresh();destroyFeedScroller()}
function destroyInfoScroller(){infopagescroll&&($j(window).unbindOrientationChange(initiateInfoScroller),infopagescroll.destroy(),infopagescroll=void 0)}function initiateFeedScroller(){void 0===feedpagescroll?(feedpagescroll=createScroller("feedscroller"),$j(window).orientationChange(initiateFeedScroller)):feedpagescroll.refresh();destroyInfoScroller()}
function destroyFeedScroller(){feedpagescroll&&($j(window).unbindOrientationChange(initiateFeedScroller),feedpagescroll.destroy(),feedpagescroll=void 0)}
function sessionCallback(){var a,c,b,d,f,g=0,e=StorageManager.getLocalValue(last_visited_loc_storage_key),h=function(){f.hide();LocalyticsManager.logAppReady()};$j("#loggedin").css("display","block");f=$j("#loggedin").showActivityInd("Loading...");addClickListeners();e&&2==e.split("/").length?(e=e.split("/"),c=e[0],d=function(){"info"!=e[1]&&renderContactInfo(e[0]);addLeftNavClickListeners([e[0]]);switchDetailSection(e[1]||"info",[e[0]],h)},a=function(b){b&&switchToDetail(d)}):(b=function(b){b&&(g+=
1,2==g&&showContactNews(h,!1))},a=function(a){b(a)});fetchContactDescribe(a);sobjectModel={setRecords:function(b){this.records=b;this.recordIds=[];for(i in b)this.recordIds.push(b[i].Id)}};splitView=new sforce.SplitView;listView=new sforce.ListView({selectedContactId:c,onListSelect:getContacts,onSearch:searchContacts,onItemSelect:showContact});splitView.addOrientationChangeCallback(function(b){listView.refreshScroller();LocalyticsManager.tagScreenOrientation(b)});listView.displayList("recent",b);
"function"==typeof window.addToHomeLaunch&&window.addToHomeLaunch()}function switchToDetail(a){useAnimations?$j("#detailpage").slideInLeft(function(){switch(isPortrait()){case !1:$j("#detailpage").css(vendor+"Transform","none")}}):$j("#detailpage").show().css("visibility","");"function"==typeof a&&a()}
function addClickListeners(){$j("#listpage #footer #gear").off().enableTap().click(function(a){a.preventDefault();splitView.focusOutContactList();setTimeout(SettingsManager.show,10)});$j("#listpage #footer #home").off().enableTap().click(function(a){a.preventDefault();splitView.focusOutContactList();showContactNews(null,!0)})}
function showContact(a,c){addLeftNavClickListeners([a]);splitView.focusOutContactList();$j("#rightsection #detailpage #detail").css("visibility","hidden").css("opacity","0");$j("#detailpage .header>span").empty();switchToDetail();var b=$j("#rightsection").showActivityInd("Loading...");switchDetailSection("info",[a],function(a){a&&$j("#rightsection #detailpage #detail").css("visibility","").css("opacity","1");b.hide();"function"==typeof c&&c()});updateLastVisitLoc(a+"/info");"function"==typeof showContactPicture&&
showContactPicture(a)}function getChatter(a,c){hasChatterEnabled?ManageUserSession.getApiClient().fetchChatterViaApex([a],function(b){var a=[];0<b.totalSize&&(a=b.records);feedRenderer(a,"No chatter updates found.");c&&c()},errorCallback,function(b,a){"function"==typeof c&&c(a)}):c()}
function getActivities(a,c){ManageUserSession.getApiClient().fetchActivitiesViaApex([a],function(b){var a=[];0<b.tasks.totalSize&&(a=b.tasks.records);feedRenderer(a,"No activities found.");c&&c()},errorCallback,function(b,a){"function"==typeof c&&c(a)})}
function displayContactSummary(a){$j("#Id").val(a.Id);var c=getFieldDescribe(),b=$j("#rightsection #detailpage #detail");b.find("#summary #photo_div>div#name").html(formatStr(a.Name,25));c.AccountId?(b.find("#summary #company").show(),b.find("#summary #company .fieldLbl").text(c.AccountId.relationshipLabel.toUpperCase(),!0),b.find("#summary #company .fieldVal").text(a.Account?a.Account.Name:" ",!0)):b.find("#summary #company").hide();c.Title?(b.find("#summary #title").show(),b.find("#summary #title .fieldLbl").text(c.Title.label.toUpperCase(),
!0),b.find("#summary #title .fieldVal").text(a.Title||" ",!0)):b.find("#summary #title").hide();c.Phone?(b.find("#summary #phone").show(),b.find("#summary #phone .fieldLbl").text(c.Phone.label.toUpperCase(),!0),b.find("#summary #phone .fieldVal").text(a.Phone||" ",!0)):b.find("#summary #phone").hide();a.Phone?(c=cleanupPhone(a.Phone),b.find("#call_contact #skype").attr("href","skype:"+c+"?call").show(),/ipad|iphone/gi.test(navigator.platform)?b.find("#call_contact #facetime").attr("href","facetime://"+
c).show():b.find("#call_contact #facetime").hide()):(b.find("#call_contact #skype").attr("href","#").hide(),b.find("#call_contact #facetime").attr("href","#").hide());a.Email?b.find("#call_contact #email").attr("href","mailto:"+a.Email).show():b.find("#call_contact #email").attr("href","#").hide();(a=formatAddress(a))&&0<a.length?b.find("#call_contact #directions").show().attr("href","https://maps.google.com/maps?daddr="+a.replace(/\n/g,", ")):b.find("#call_contact #directions").hide()}
function displayContactDetails(a){var c=getFieldDescribe(),b=$j("#rightsection #detailpage #detail #info");c.AccountId?(b.find("#Account").show(),b.find("#Account .fieldLbl").text(c.AccountId.relationshipLabel),b.find("#Account .fieldVal").html(a.Account?formatStr(a.Account.Name,50):"&nbsp;")):b.find("#Account").hide();c.Department?(b.find("#Department").show(),b.find("#Department .fieldLbl").text(c.Department.label),b.find("#Department .fieldVal").html(formatStr(a.Department,50)||"&nbsp;")):b.find("#Department").hide();
c.Phone?(b.find("#Phone").show(),b.find("#Phone .fieldLbl").text(c.Phone.label),b.find("#Phone .fieldVal").html(a.Phone?'<a href="tel:'+formatStr(cleanupPhone(a.Phone))+'" style="text-decoration:none;">'+formatStr(a.Phone,30)+"</a>":"&nbsp;")):b.find("#Phone").hide();c.MobilePhone?(b.find("#Mobile").show(),b.find("#Mobile .fieldLbl").text(c.MobilePhone.label),b.find("#Mobile .fieldVal").html(a.MobilePhone?'<a href="tel:'+formatStr(cleanupPhone(a.MobilePhone))+'">'+formatStr(a.MobilePhone,30)+"</a>":
"&nbsp;")):b.find("#Mobile").hide();c.Email?(b.find("#Email").show(),b.find("#Email .fieldLbl").text(c.Email.label),b.find("#Email .fieldVal").html(a.Email?'<a href="mailto:'+a.Email+'" style="text-decoration:none;">'+formatStr(a.Email,50)+"</a>":"&nbsp;")):b.find("#Email").hide();c.ReportsToId?(b.find("#ReportsTo").show(),b.find("#ReportsTo .fieldLbl").text(c.ReportsToId.label.replace(/\sID$/,"")),b.find("#ReportsTo .fieldVal").html(a.ReportsTo?formatStr(a.ReportsTo.Name,50):"&nbsp;")):b.find("#ReportsTo").hide();
void 0!=c.MailingStreet?(a=formatAddress(a),b.find("#Address").show(),b.find("#Address .fieldLbl").text("Mailing Address"),b.find("#Address .fieldVal").html(0<a.length?a.replace(/\n/g,"<br/>"):"&nbsp;"),codeAddressOnMap(a.replace(/\n/g,", "))):(b.find("#Address").hide(),$j("#map_section").hide())}
function renderContactInfo(a,c){var b=!1,d="Id Name Account.Id Account.Name Department Title Phone MobilePhone Email MailingStreet MailingCity MailingState MailingCountry MailingPostalCode ReportsTo.Name".split(" ");hasRecordTypes&&d.push("RecordTypeId");var f=getFieldDescribe(),d=d.filter(function(a){a=a.split(".");return f[a[0]]});$j("#rightsection #detailpage #detail #info");ManageUserSession.getApiClient().retrieveContactViaApex(a,d,function(a){a&&"Id"in a?($j("#detailpage .header>span").text(a.Name),
displayContactSummary(a),displayContactDetails(a),renderContactLayout(a.Id,a.RecordTypeId),b=!0):(alert(contactLabel+" not found. Please refresh the list and try again."),showContactNews(null,!0))},errorCallback,function(){"function"==typeof c&&(setTimeout(function(){initiateInfoScroller();infopagescroll.scrollTo(0,0,0)},10),c(b))})}
function formatDetailContent(a){$j.each(a.find(".time"),function(){this.innerHTML=$j.format.date(this.innerHTML.trim(),"hh:mm a")});$j.each(a.find(".textarea"),function(){this.innerHTML=this.innerHTML.replace(/[\r\n]/g,"<br/>")})}
function renderContactLayout(a,c){var b=$j("#rightsection #detailpage #detail #info #detailsLayout");b.find("#layout").empty();b.find("#viewMoreBtn").find("span").text("Load All Details");b.find("#viewMoreBtn").find("img").hide();b.find("#viewMoreBtn").show().off().enableTap().click(function(){$j(this).off().find("span").text("Loading Details...");$j(this).find("img").show();ManageUserSession.getApiClient().getContactDetailsViaApex(a,c,function(a){a=$j(a);a.find("head, script").remove();formatDetailContent(b.find("#layout").empty().append(a));
b.find("#viewMoreBtn").hide()},errorCallback,function(){initiateInfoScroller()})})}
function showContactNews(a,c){splitView.focusOutContactList();$j("#detailpage #contactInfo").hide();$j("#detailpage .header>span").text(contactLabel+" Feed");$j("#feedscroller ul").empty();$j("#feedscroller").appendTo("#contactNews .contentpage").css("visibility","hidden").show();$j("#detailpage #contactNews").show();listView.resetSelectedContact();var b;c&&(b=$j("#rightsection").showActivityInd("Loading..."));switchToDetail();getAggregateFeed(sobjectModel.recordIds,function(c){"success"==c&&$j("#feedscroller").css("visibility",
"");initiateFeedScroller();b&&b.hide();"function"==typeof a&&a()},{includeParent:!0,onClickParent:function(a){this.id.startsWith("contact_")&&(a.preventDefault(),listView.selectContact(this.id.substring(8)))}});LocalyticsManager.tagScreen("Home Feed")}
function getAggregateFeed(a,c,b){var d=[],f=function(){if(d[0]&&d[1]){var a=d[0].concat(d[1]),c=function(a){return(a="ActivityDate"in a?a.ActivityDate?a.ActivityDate:a.LastModifiedDate:a.CreatedDate)?$j.format.toDate(a):new Date};a.sort(function(a,b){var e=c(a),d=c(b);return e==d?0:e>d?-1:1});feedRenderer(a,"No updates found.",b)}},g=function(a,b){"function"==typeof c&&("success"!=b||d[0]&&d[1])&&c(b)};hasChatterEnabled?ManageUserSession.getApiClient().fetchChatterViaApex(a,function(a){d[0]=0<a.totalSize?
a.records:[];f()},errorCallback,g):(d[0]=[],f());ManageUserSession.getApiClient().fetchActivitiesViaApex(a,function(a){d[1]=a.tasks&&a.tasks.totalSize>0?a.tasks.records:[];f()},errorCallback,g)}
function addLeftNavClickListeners(a){$j("#rightsection #detailpage #leftnav .dsIcons").off().enableTap().click(function(){var c="Loading";switch(this.id){case "info":c+=" Details";break;case "rss":c+=" All Feeds";break;case "chatter":c+=" Chatter";break;case "salesforce":c+=" Activities"}c=$j("#rightsection #detailpage").showActivityInd(c+"...");switchDetailSection(this.id,a,c.hide)});hasChatterEnabled||$j("#rightsection #detailpage #leftnav #chatter").hide()}
function switchDetailSection(a,c,b){var d=Date.now();$j("#feedscroller ul").empty();$j("#feedscroller").appendTo("#rightsection #detailpage #detail>span");$j("#detailpage #contactInfo").show();$j("#detailpage #contactNews").hide();$j("#rightsection #detailpage #detail>span>div").hide().css("visibility","hidden");$j("#rightsection #detailpage #leftnav div.selected").removeClass("selected");$j("#rightsection #detailpage #leftnav #"+a).addClass("selected");"info"==a?($j("#rightsection #detailpage #detail #infoscroller").show(),
destroyFeedScroller()):($j("#rightsection #detailpage #detail #feedscroller").show(),destroyInfoScroller());var f=function(c){LocalyticsManager.tagDetailView(a,Date.now()-d);typeof b=="function"&&b(c)},g=function(){$j("#rightsection #detailpage #detail #feedscroller").css("visibility","");initiateFeedScroller();f()};"info"==a?(renderContactInfo(c[0],function(a){a&&$j("#rightsection #detailpage #detail #infoscroller").css("visibility","");f(a)}),LocalyticsManager.tagScreen("Detail")):"chatter"==a?
(getChatter(c[0],g),LocalyticsManager.tagScreen("Chatter Feed")):"salesforce"==a?(getActivities(c[0],g),LocalyticsManager.tagScreen("Activity Feed")):"rss"==a?(getAggregateFeed([c[0]],g),LocalyticsManager.tagScreen("Aggregate Feed")):f();updateLastVisitLoc(c[0]+"/"+a)}
function codeAddressOnMap(a){var c=encodeURI(a);$j("#map_section #map_div #google_map_canvas").empty().append('<img src="https://maps.googleapis.com/maps/api/staticmap?zoom=14&size=640x180&format=jpeg&sensor=false&markers=color:red%7C'+c+'"/>');$j("#map_section #map_div #openMaps").off().enableTap().click(function(){window.location=("undefined"!=typeof PhoneGap&&PhoneGap?"maps:q=":"https://maps.google.com/maps?q=")+c})};